<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin Panel - Full</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:18px;background:#f3f3f3}
  .wrap{max-width:960px;margin:0 auto}
  h1{margin-bottom:12px}
  .grid{display:grid;grid-template-columns:1fr 320px;gap:18px}
  .card{background:#fff;padding:12px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
  label{display:block;margin-top:8px;font-weight:600}
  input[type="text"], input[type="number"], input[type="color"]{width:100%;padding:8px;margin-top:6px;border:1px solid #ddd;border-radius:6px}
  input[type="file"]{margin-top:8px}
  button{padding:10px 12px;border-radius:8px;border:none;background:#ff3b3b;color:#fff;cursor:pointer;margin-top:8px}
  .small-btn{background:#007bff;margin-left:6px}
  .muted{color:#666;font-size:13px}
  .preview-img{width:100%;border-radius:6px;margin-top:8px;object-fit:contain;border:1px solid #eee}
  .list{margin-top:12px}
  .list .item{display:flex;align-items:center;gap:10px;padding:8px;border-radius:6px;border:1px solid #eee;margin-top:8px;background:#fafafa}
  .list .item img{width:64px;height:64px;object-fit:cover;border-radius:6px}
  .list .right{margin-left:auto;display:flex;gap:6px}
  .danger{background:#e74c3c}
  textarea{width:100%;min-height:60px;padding:8px;border-radius:6px;border:1px solid #ddd}
  @media(max-width:900px){ .grid{grid-template-columns:1fr} }
</style>
</head>
<body>
<div class="wrap">
  <h1>Admin Panel — Full Control</h1>
  <div class="grid">

    <!-- left: controls -->
    <div class="card">
      <h3>Header (Hero)</h3>
      <input type="file" id="heroUpload" accept="image/*">
      <label>Size Ratio (%)</label>
      <input type="number" id="heroSize" min="50" max="200" value="100">
      <div style="display:flex;gap:8px">
        <button id="heroSave">Save Header</button>
        <button id="heroDelete" class="danger">Delete</button>
      </div>
      <img id="heroPreview" class="preview-img" src="" alt="Hero preview">

      <hr style="margin:12px 0">

      <h3>Static Image (below header)</h3>
      <input type="file" id="staticUpload" accept="image/*">
      <label>Size Ratio (%)</label>
      <input type="number" id="staticSize" min="50" max="200" value="100">
      <div style="display:flex;gap:8px">
        <button id="staticSave">Save Static</button>
        <button id="staticDelete" class="danger">Delete</button>
      </div>
      <img id="staticPreview" class="preview-img" src="" alt="Static preview">

      <hr style="margin:12px 0">

      <h3>Slider Images (max 5)</h3>
      <input type="file" id="sliderUpload" accept="image/*" multiple>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="addSliderBtn">Add Selected</button>
        <button id="clearSliderBtn" class="danger">Clear All</button>
      </div>
      <div id="sliderList" class="list"></div>

      <hr style="margin:12px 0">

      <h3>Countdown & Sell</h3>
      <label>Timer Minutes</label><input id="timerMinutes" type="number" min="1" value="20">
      <label>Sale Text</label><input id="saleText" type="text" value="Sale of the Day">
      <label>Sale Text Color</label><input id="saleTextColor" type="color" value="#ff3b3b">
      <label>Timer Background</label><input id="timerBgColor" type="color" value="#ffffff">
      <label>Sell Button Text</label><input id="sellText" type="text" value="Sell is Live">
      <label>Sell Text Color</label><input id="sellTextColor" type="color" value="#ffffff">
      <label>Sell Background Color</label><input id="sellBgColor" type="color" value="#ff3b3b">
      <button id="saveCountdown">Save Countdown & Sell</button>
    </div>

    <!-- right: products management -->
    <div class="card">
      <h3>Products (Add / Edit)</h3>

      <label>Product Name</label>
      <input id="prodName" type="text" placeholder="Product name">

      <label>Old Price (₹)</label>
      <input id="prodOld" type="number" placeholder="Old price">

      <label>New Price (₹)</label>
      <input id="prodNew" type="number" placeholder="New price">

      <label>Discount (%)</label>
      <input id="prodDiscount" type="number" value="99" min="0" max="100">

      <label>Image (you can paste URL or choose file)</label>
      <input id="prodImageUrl" type="text" placeholder="Image URL" oninput="prodPreviewFromUrl()">
      <input id="prodImageFile" type="file" accept="image/*">

      <div style="margin-top:8px;text-align:center">
        <img id="prodPreview" src="https://via.placeholder.com/140x140?text=Preview" style="width:140px;height:140px;object-fit:cover;border-radius:8px;border:1px solid #eee">
      </div>

      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="saveProductBtn">Save Product</button>
        <button id="clearFormBtn" class="small-btn">Clear</button>
      </div>

      <h4 style="margin-top:14px">Existing Products</h4>
      <div id="productList" class="list"></div>
    </div>

  </div> <!-- grid -->
</div>

<script>
/* Utilities */
function toBase64(file, cb){ const r=new FileReader(); r.onload=e=>cb(e.target.result); r.readAsDataURL(file); }
function safeParse(key){ try{return JSON.parse(localStorage.getItem(key))||[];}catch(e){return [];} }

/* ---------- Header (hero) ---------- */
const heroUpload = document.getElementById('heroUpload');
const heroPreview = document.getElementById('heroPreview');
const heroSize = document.getElementById('heroSize');
const heroSave = document.getElementById('heroSave');
const heroDelete = document.getElementById('heroDelete');

if(localStorage.getItem('headerImage')) {
  heroPreview.src = localStorage.getItem('headerImage');
  heroSize.value = localStorage.getItem('heroSize')||100;
} else heroPreview.src = 'https://via.placeholder.com/1200x360?text=Header+Preview';

let heroFileData = null;
heroUpload.addEventListener('change', e=>{
  const f = e.target.files[0];
  if(!f) return;
  toBase64(f, data=>{ heroFileData = data; heroPreview.src = data; });
});
heroSave.addEventListener('click', ()=>{
  if(heroFileData) localStorage.setItem('headerImage', heroFileData);
  localStorage.setItem('heroSize', heroSize.value || 100);
  alert('Header saved.');
  // update index if open
});
heroDelete.addEventListener('click', ()=>{
  if(confirm('Delete header image?')){
    localStorage.removeItem('headerImage'); localStorage.removeItem('heroSize'); heroPreview.src='';
    alert('Header removed');
  }
});

/* ---------- Static ---------- */
const staticUpload = document.getElementById('staticUpload');
const staticPreview = document.getElementById('staticPreview');
const staticSize = document.getElementById('staticSize');
const staticSave = document.getElementById('staticSave');
const staticDelete = document.getElementById('staticDelete');

if(localStorage.getItem('staticImage')){
  staticPreview.src = localStorage.getItem('staticImage');
  staticSize.value = localStorage.getItem('staticSize')||100;
} else staticPreview.src = 'https://via.placeholder.com/1200x200?text=Static+Preview';

let staticFileData = null;
staticUpload.addEventListener('change', e=>{
  const f=e.target.files[0];
  if(!f) return;
  toBase64(f,data=>{ staticFileData = data; staticPreview.src = data; });
});
staticSave.addEventListener('click', ()=>{
  if(staticFileData) localStorage.setItem('staticImage', staticFileData);
  localStorage.setItem('staticSize', staticSize.value || 100);
  alert('Static saved.');
});
staticDelete.addEventListener('click', ()=>{
  if(confirm('Delete static image?')){ localStorage.removeItem('staticImage'); localStorage.removeItem('staticSize'); staticPreview.src=''; alert('Deleted'); }
});

/* ---------- Slider ---------- */
const sliderUpload = document.getElementById('sliderUpload');
const addSliderBtn = document.getElementById('addSliderBtn');
const clearSliderBtn = document.getElementById('clearSliderBtn');
const sliderList = document.getElementById('sliderList');

let sliderImages = safeParse('sliderImages');
function renderSliderList(){
  sliderList.innerHTML = '';
  sliderImages.forEach((src,i)=>{
    const div = document.createElement('div'); div.className='item';
    div.innerHTML = `<img src="${src}"><div style="flex:1"><b>Slide ${i+1}</b></div>
                     <div class="right">
                       <button onclick="deleteSlide(${i})" class="danger">Delete</button>
                     </div>`;
    sliderList.appendChild(div);
  });
}
function deleteSlide(i){ if(confirm('Delete slide?')){ sliderImages.splice(i,1); localStorage.setItem('sliderImages', JSON.stringify(sliderImages)); renderSliderList(); alert('Deleted'); } }
renderSliderList();

addSliderBtn.addEventListener('click', ()=>{
  const files = Array.from(sliderUpload.files).slice(0,5 - sliderImages.length);
  if(files.length===0){ alert('Choose images (max 5)'); return; }
  let count=0;
  files.forEach(f=> toBase64(f, data=>{
    sliderImages.push(data);
    count++;
    if(count===files.length){
      localStorage.setItem('sliderImages', JSON.stringify(sliderImages));
      renderSliderList();
      alert('Slides added');
      sliderUpload.value='';
    }
  }));
});

clearSliderBtn.addEventListener('click', ()=>{
  if(confirm('Clear all slider images?')){
    sliderImages=[]; localStorage.removeItem('sliderImages'); renderSliderList(); alert('Cleared');
  }
});

/* ---------- Countdown & Sell ---------- */
const timerMinutes = document.getElementById('timerMinutes');
const saleText = document.getElementById('saleText');
const saleTextColor = document.getElementById('saleTextColor');
const timerBgColor = document.getElementById('timerBgColor');
const sellText = document.getElementById('sellText');
const sellTextColor = document.getElementById('sellTextColor');
const sellBgColor = document.getElementById('sellBgColor');
const saveCountdown = document.getElementById('saveCountdown');

(function loadCountdownForm(){
  timerMinutes.value = localStorage.getItem('timerMinutes') || 20;
  saleText.value = localStorage.getItem('saleText') || 'Sale of the Day';
  saleTextColor.value = localStorage.getItem('saleTextColor') || '#ff3b3b';
  timerBgColor.value = localStorage.getItem('timerBgColor') || '#ffffff';
  sellText.value = localStorage.getItem('sellText') || 'Sell is Live';
  sellTextColor.value = localStorage.getItem('sellTextColor') || '#ffffff';
  sellBgColor.value = localStorage.getItem('sellBgColor') || '#ff3b3b';
})();
saveCountdown.addEventListener('click', ()=>{
  localStorage.setItem('timerMinutes', timerMinutes.value);
  localStorage.setItem('saleText', saleText.value);
  localStorage.setItem('saleTextColor', saleTextColor.value);
  localStorage.setItem('timerBgColor', timerBgColor.value);
  localStorage.setItem('sellText', sellText.value);
  localStorage.setItem('sellTextColor', sellTextColor.value);
  localStorage.setItem('sellBgColor', sellBgColor.value);
  alert('Countdown & Sell saved');
});

/* ---------- Products CRUD ---------- */
const prodName = document.getElementById('prodName');
const prodOld = document.getElementById('prodOld');
const prodNew = document.getElementById('prodNew');
const prodDiscount = document.getElementById('prodDiscount');
const prodImageUrl = document.getElementById('prodImageUrl');
const prodImageFile = document.getElementById('prodImageFile');
const prodPreview = document.getElementById('prodPreview');
const saveProductBtn = document.getElementById('saveProductBtn');
const clearFormBtn = document.getElementById('clearFormBtn');
const productList = document.getElementById('productList');

let products = safeParse('products');
let editingIndex = -1;
let chosenImageData = ''; // base64 or URL

function renderProducts(){
  productList.innerHTML = '';
  products.forEach((p,i)=>{
    const item = document.createElement('div'); item.className='item';
    item.innerHTML = `<img src="${p.image}"><div style="display:flex;flex-direction:column">
      <b>${escapeHtml(p.name)}</b>
      <small>${p.discount}% OFF | ₹${p.newPrice}</small>
    </div>
    <div class="right">
      <button onclick="editProduct(${i})">Edit</button>
      <button onclick="deleteProduct(${i})" class="danger">Delete</button>
    </div>`;
    productList.appendChild(item);
  });
}
function escapeHtml(s){ return (s+'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

function prodPreviewFromUrl(){ const url = prodImageUrl.value.trim(); prodPreview.src = url || 'https://via.placeholder.com/140x140?text=Preview'; chosenImageData = url; }
// file -> base64 preview
prodImageFile.addEventListener('change', e=>{
  const f = e.target.files[0];
  if(!f) return;
  toBase64(f, data=>{ chosenImageData = data; prodPreview.src = data; });
});

clearFormBtn.addEventListener('click', clearProductForm);

function clearProductForm(){
  prodName.value=''; prodOld.value=''; prodNew.value=''; prodDiscount.value='99'; prodImageUrl.value=''; prodImageFile.value=''; prodPreview.src='https://via.placeholder.com/140x140?text=Preview'; chosenImageData='';
  editingIndex = -1;
  saveProductBtn.innerText = 'Save Product';
}

saveProductBtn.addEventListener('click', ()=>{
  const name = prodName.value.trim();
  const oldP = prodOld.value.trim();
  const newP = prodNew.value.trim();
  const disc = prodDiscount.value.trim();
  const image = (chosenImageData && chosenImageData.length>0) ? chosenImageData : prodImageUrl.value.trim();

  if(!name || !oldP || !newP || !image){ alert('Fill name, old price, new price and image.'); return; }

  const productObj = { name, oldPrice: oldP, newPrice: newP, discount: disc || '0', image };
  if(editingIndex > -1){
    products[editingIndex] = productObj;
    editingIndex = -1;
    alert('Product updated.');
  } else {
    products.push(productObj);
    alert('Product added.');
  }
  localStorage.setItem('products', JSON.stringify(products));
  clearProductForm();
  renderProducts();
});

function editProduct(i){
  const p = products[i];
  prodName.value = p.name;
  prodOld.value = p.oldPrice;
  prodNew.value = p.newPrice;
  prodDiscount.value = p.discount;
  prodImageUrl.value = p.image.startsWith('data:') ? '' : p.image;
  prodPreview.src = p.image;
  chosenImageData = p.image;
  editingIndex = i;
  saveProductBtn.innerText = 'Update Product';
  // remove old entry from list while editing? We'll just overwrite on save
}

function deleteProduct(i){
  if(confirm('Delete this product?')){
    products.splice(i,1);
    localStorage.setItem('products', JSON.stringify(products));
    renderProducts();
  }
}

/* initialize rendering on load */
(function init(){
  renderProducts();
  renderSliderList();
})();
</script>
</body>
</html>
